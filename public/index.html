<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMW - Better Mental Wellness</title>
    <style>
        :root{--primary: linear-gradient(135deg,#667eea 0%,#764ba2 100%);--secondary: linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);--success:#51cf66;--error:#ff4757;}
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',sans-serif;line-height:1.6;color:#333;overflow-x:hidden}
        .container{max-width:900px;margin:0 auto;padding:20px}.gradient-bg{background:var(--primary);color:white;text-align:center;padding:60px 20px;animation:fadeIn 1s}
        .gradient-bg h1{font-size:clamp(2em,5vw,3em);margin-bottom:10px}.benefits{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin:40px 0}
        .benefit{background:rgba(255,255,255,0.1);padding:20px;border-radius:15px;backdrop-filter:blur(10px);transition:transform 0.3s}.benefit:hover{transform:translateY(-5px)}
        form{background:white;padding:30px;border-radius:20px;box-shadow:0 15px 35px rgba(0,0,0,0.1);margin:20px 0;max-width:500px;margin:20px auto}
        input,select,button{width:100%;padding:14px;margin:10px 0;border:1px solid #ddd;border-radius:10px;font-size:16px;box-sizing:border-box}
        button{background:var(--primary);color:white;border:none;cursor:pointer;font-weight:600;transition:all 0.3s;border-radius:10px}
        button:hover{transform:scale(1.02);box-shadow:0 5px 15px rgba(0,0,0,0.2)}
        .nav-tabs{display:flex;gap:10px;margin:20px 0}.tab{flex:1;padding:15px;background:rgba(255,255,255,0.9);border-radius:10px;cursor:pointer;transition:all 0.3s;font-weight:500}
        .tab.active,.tab:hover{background:white;box-shadow:0 5px 15px rgba(0,0,0,0.1)}.hidden{display:none}
        .section{background:var(--secondary);color:white;padding:40px;border-radius:20px;margin:20px 0;text-align:center;animation:slideIn 0.5s}
        .score{font-size:clamp(2.5em,10vw,5em);font-weight:900;margin:20px 0;background:linear-gradient(45deg,#fff,#f0f8ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .plan-list{text-align:left;list-style:none;max-width:600px;margin:0 auto}.plan-list li{background:rgba(255,255,255,0.2);padding:20px;margin:15px 0;border-radius:15px;backdrop-filter:blur(10px)}
        table{width:100%;border-collapse:collapse;margin:30px 0;background:white;border-radius:15px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.1);color:#333}
        th,td{padding:15px;text-align:left;border-bottom:1px solid #eee}th{background:var(--primary);color:white;font-weight:600}
        .status{padding:12px 20px;border-radius:8px;margin:10px 0;font-weight:500}.status.error{background:#ff6b7a;color:white}.status.success{background:var(--success);color:white}
        .question{margin:20px 0;padding:20px;background:#f8f9ff;border-radius:12px;border-left:4px solid var(--primary)}
        @keyframes fadeIn{from{opacity:0;transform:translateY(-30px)}to{opacity:1;transform:translateY(0)}}
        @keyframes slideIn{from{opacity:0;transform:translateX(-30px)}to{opacity:1;transform:translateX(0)}}
        @media(max-width:768px){.container{padding:10px}.benefits{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="gradient-bg">
        <h1>üåü BMW - Better Mental Wellness</h1>
        <p>Your personalized path to mental wellness, powered by science</p>
    </div>

    <div class="container">
        <section class="benefits">
            <div class="benefit">
                <h3>üìà Smart Tracking</h3>
                <p>Monitor progress with sc-wellness assessments</p>
            </div>
            <div class="benefit">
                <h3>‚ú® Personalized Plans</h3>
                <p>ra-wellness activities tailored to your needs</p>
            </div>
            <div class="benefit">
                <h3>üîê Secure Profile</h3>
                <p>Your data stays private and encrypted</p>
            </div>
            <div class="benefit">
                <h3>üì± Works Everywhere</h3>
                <p>Web-first, mobile-ready PWA</p>
            </div>
        </section>

        <div id="authSection">
            <div class="nav-tabs">
                <div class="tab active" onclick="showTab('register')">Register</div>
                <div class="tab" onclick="showTab('login')">Login</div>
            </div>
            <form id="registerForm">
                <h2>Create Account</h2>
                <input type="text" id="regName" placeholder="Full Name" required>
                <input type="email" id="regEmail" placeholder="Email Address" required>
                <input type="password" id="regPassword" placeholder="Password (6+ chars)" required minlength="6">
                <button type="submit">üöÄ Get Started</button>
                <div id="regStatus" class="status hidden"></div>
            </form>
            <form id="loginForm" class="hidden">
                <h2>Welcome Back</h2>
                <input type="email" id="loginEmail" placeholder="Email Address" required>
                <input type="password" id="loginPassword" placeholder="Password" required>
                <button type="submit">üì± Login</button>
                <div id="loginStatus" class="status hidden"></div>
            </form>
        </div>

        <form id="quizForm" class="hidden">
            <h2>üß† sc-wellness Assessment</h2>
            <p style="margin-bottom:20px;color:#666;font-size:0.95em">Over the last 2 weeks... (0=Not at all, 1=Several days, 2=More than half, 3=Nearly every day)</p>
            <div class="question">
                <label>1. Little interest or pleasure in doing things?</label>
                <select id="q1"><option value="0">0 - Not at all</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </div>
            <div class="question">
                <label>2. Feeling down, depressed, or hopeless?</label>
                <select id="q2"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </div>
            <div class="question">
                <label>3. Trouble falling/staying asleep, or sleeping too much?</label>
                <select id="q3"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </div>
            <div class="question">
                <label>4. Feeling nervous, anxious, or on edge?</label>
                <select id="q4"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </div>
            <div class="question">
                <label>5. Unable to stop or control worrying?</label>
                <select id="q5"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </div>
            <button type="submit">üíæ Save & Get My Plan</button>
        </form>

        <div id="profile" class="section hidden">
            <h2>üëã Welcome back, <span id="userName"></span>!</h2>
            <p id="userEmail"></p>
            <div id="trend" style="margin:20px 0;font-size:1.1em"></div>
            <div style="display:flex;gap:15px;justify-content:center;flex-wrap:wrap">
                <button onclick="showQuiz()">üìä New Assessment</button>
                <button onclick="showPlan()">‚ú® My Wellness Plan</button>
            </div>
        </div>

        <div id="results" class="section hidden">
            <h2>Your Score: <span id="score" class="score">0</span> / 20</h2>
            <p id="interpretation" style="font-size:1.3em;margin:20px 0"></p>
            <button onclick="showPlan()">üéØ Generate Personalized Plan</button>
        </div>

        <div id="plan" class="section hidden">
            <h2>‚ú® Your Personalized ra-wellness Plan</h2>
            <p>Based on score <span id="planScore"></span> (<span id="planLevel"></span>)</p>
            <h3 style="margin:30px 0 20px 0">üèÜ Top 3 Recommendations</h3>
            <ul id="planList" class="plan-list"></ul>
            <h3 style="margin:40px 0 20px 0">üìã Full ra-wellness Activities</h3>
            <table id="raTable">
                <thead><tr><th>Activity</th><th>More Information</th></tr></thead>
                <tbody></tbody>
            </table>
            <button onclick="showProfile()" style="margin-top:30px">üè† Back to Dashboard</button>
        </div>
    </div>

    <script>
        const API_BASE = window.location.pathname === '/' ? '/api' : '/api';
        const questions = ['q1','q2','q3','q4','q5'];
        let currentUser = null;

        async function api(endpoint, options = {}) {
            const res = await fetch(`${API_BASE}${endpoint}`, {
                headers: {'Content-Type': 'application/json'},
                ...options
            });
            if (!res.ok) {
                const err = await res.json();
                throw new Error(err.error || 'API Error');
            }
            return res.json();
        }

        function showStatus(el, message, type) {
            const status = document.getElementById(el);
            status.textContent = message;
            status.className = `status ${type}`;
            status.classList.remove('hidden');
        }

        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('registerForm').classList.toggle('hidden', tab !== 'register');
            document.getElementById('loginForm').classList.toggle('hidden', tab !== 'login');
        }

        function hideAll() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('quizForm').classList.add('hidden');
            document.getElementById('profile').classList.add('hidden');
            document.getElementById('results').classList.add('hidden');
            document.getElementById('plan').classList.add('hidden');
        }

        function showSection(id) {
            hideAll();
            document.getElementById(id).classList.remove('hidden');
        }

        document.getElementById('registerForm').addEventListener('submit', async e => {
            e.preventDefault();
            const formData = Object.fromEntries(new FormData(e.target));
            try {
                showStatus('regStatus', 'Creating account...', 'success');
                await api('/register', {method: 'POST', body: JSON.stringify(formData)});

                const loginData = {email: formData.regEmail, password: formData.regPassword};
                currentUser = (await api('/login', {method: 'POST', body: JSON.stringify(loginData)})).user;
                showStatus('regStatus', 'Success! Loading profile...', 'success');
                setTimeout(() => loadProfile(), 1000);
            } catch (err) {
                showStatus('regStatus', err.message, 'error');
            }
        });

        document.getElementById('loginForm').addEventListener('submit', async e => {
            e.preventDefault();
            const formData = {email: document.getElementById('loginEmail').value, password: document.getElementById('loginPassword').value};
            try {
                showStatus('loginStatus', 'Signing in...', 'success');
                currentUser = (await api('/login', {method: 'POST', body: JSON.stringify(formData)})).user;
                loadProfile();
            } catch (err) {
                showStatus('loginStatus', err.message, 'error');
            }
        });

        async function loadProfile() {
            const profile = await api(`/profile/${currentUser.id}`);
            currentUser.profile = profile;
            document.getElementById('userName').textContent = profile.name;
            document.getElementById('userEmail').textContent = profile.email;
            updateTrend(profile.scores);
            showSection('profile');
        }

        function updateTrend(scores) {
            const trendEl = document.getElementById('trend');
            if (!scores || scores.length === 0) {
                trendEl.textContent = 'üëã Take your first assessment to see trends!';
                return;
            }
            const avg = (scores.reduce((a,b)=>a+b,0) / scores.length).toFixed(1);
            const latest = scores[scores.length-1];
            const trend = latest < scores[0] ? 'üéâ Improving!' : scores.length > 1 ? 'üìà Steady progress' : 'üìä First score';
            trendEl.innerHTML = `üìä Average: ${avg}/20 | ${trend} | Latest: ${latest}`;
        }

        document.getElementById('quizForm').addEventListener('submit', async e => {
            e.preventDefault();
            let score = 0;
            questions.forEach(q => score += parseInt(document.getElementById(q).value));

            const interp = score >=15 ? '‚ö†Ô∏è Severe symptoms - consider professional support' :
                          score >=10 ? 'üìà Moderate symptoms' :
                          score >=5 ? 'üëç Mild symptoms' : '‚úÖ Minimal symptoms';

            document.getElementById('score').textContent = score;
            document.getElementById('interpretation').textContent = interp;

            await api(`/score/${currentUser.id}`, {method: 'POST', body: JSON.stringify({score})});
            showSection('results');
        });

        async function showPlan() {
            const latestScore = currentUser.profile?.scores?.[currentUser.profile.scores.length-1] || 5;
            const planData = await api(`/plan/${latestScore}`);

            document.getElementById('planScore').textContent = planData.score;
            document.getElementById('planLevel').textContent = planData.level.toUpperCase();

            const list = document.getElementById('planList');
            list.innerHTML = planData.recommendations.map(r => 
                `<li>‚úÖ ${r.activity}<br><small>${r.source}</small></li>`
            ).join('');

            const tbody = document.querySelector('#raTable tbody');
            tbody.innerHTML = planData.fullTable.map(r => 
                `<tr><td>${r.activity}</td><td>${r.source}</td></tr>`
            ).join('');

            showSection('plan');
        }

        function showQuiz() {
            questions.forEach(q => document.getElementById(q).value = 0);
            showSection('quizForm');
        }

        function showProfile() {
            loadProfile();
        }

        window.addEventListener('load', () => {
            document.querySelector('.tab').click();
        });
    </script>
</body>
</html>
